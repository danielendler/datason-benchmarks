name: 📅 Daily Benchmarks (Dagger)

on:
  schedule:
    - cron: '0 6 * * *'  # Daily at 6:00 AM UTC
  workflow_dispatch:
    inputs:
      focus_area:
        description: 'Focus area for daily benchmarks'
        required: false
        default: 'api_modes'
        type: choice
        options:
          - api_modes
          - competitive
          - versions  
          - comprehensive

jobs:
  daily-benchmarks:
    runs-on: ubuntu-latest
    name: 📊 Run daily ${{ github.event.inputs.focus_area || 'api_modes' }} benchmarks
    
    steps:
      - name: 🔄 Checkout repository
        uses: actions/checkout@v4
        
      - name: 🐍 Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
          
      - name: 📦 Install Dagger
        run: pip install dagger-io
        
      - name: 🎯 Run Daily Benchmarks with Dagger
        run: |
          dagger call daily-benchmarks \
            --source=. \
            --focus-area="${{ github.event.inputs.focus_area || 'api_modes' }}"
        env:
          DAGGER_CLOUD_TOKEN: ${{ secrets.DAGGER_CLOUD_TOKEN }}
          
      - name: 💾 Commit and push results
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          git add data/results/ docs/results/
          
          if ! git diff --staged --quiet; then
            echo "📝 Committing daily ${{ github.event.inputs.focus_area || 'api_modes' }} benchmark results..."
            git commit -m "📊 Daily ${{ github.event.inputs.focus_area || 'api_modes' }} Benchmarks - $(date -u '+%Y-%m-%d')"
            git push origin HEAD
            echo "✅ Results committed and pushed successfully"
          else
            echo "ℹ️ No changes to commit"
          fi