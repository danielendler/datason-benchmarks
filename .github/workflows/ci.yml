# This file is generated by tools/gen_workflows.py
# DO NOT EDIT MANUALLY - Edit the Python model instead

name: 🧪 CI Tests & Validation
on:
  pull_request:
    branches:
      - main
    paths:
      - .github/workflows/**
      - scripts/**
      - tests/**
      - requirements.txt
      - '*.py'
  push:
    branches:
      - main
    paths:
      - .github/workflows/**
      - scripts/**
      - tests/**
      - requirements.txt
      - '*.py'
  workflow_dispatch:
jobs:
  workflow-validation:
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v4
      - name: 🐍 Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: 📦 Install test dependencies
        run: "python -m pip install --upgrade pip\npip install pytest pyyaml"
      - name: 🔍 Run comprehensive workflow validation tests
        run: "echo \"🔍 Running comprehensive workflow validation tests...\"\npython -m pytest tests/test_workflow_integration.py -v --tb=short"
        env:
          PYTHONUNBUFFERED: '1'
          CI: 'true'
    timeout-minutes: 10
  python-tests:
    runs-on: ${{ matrix.os }}
    steps:
      - name: 🔄 Checkout repository
        uses: actions/checkout@v4
      - name: 🐍 Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
          cache: pip
      - name: 📦 Install dependencies
        run: pip install --upgrade pip && pip install -r requirements.txt
      - name: 🧪 Run Python tests
        run: python -m pytest tests/ -v --tb=short -x
      - name: 📊 Test benchmark runners
        run: timeout 30 python scripts/run_benchmarks.py --quick --output data/results/test_ci.json || echo "⚠️ Benchmark test failed"
        continue-on-error: true
    strategy:
      fail-fast: false
      matrix:
        python-version:
          - '3.11'
          - '3.12'
        os:
          - ubuntu-latest
    timeout-minutes: 15
  script-validation:
    runs-on: ubuntu-latest
    steps:
      - name: 🔄 Checkout repository
        uses: actions/checkout@v4
      - name: 🐍 Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: pip
      - name: 📦 Install dependencies
        run: pip install --upgrade pip && pip install -r requirements.txt
      - name: 🔍 Validate script structure
        run: for script in scripts/*.py; do python -m py_compile "$script"; done
      - name: 📋 Check script imports
        run: python -c "import sys; sys.path.append('scripts'); import run_benchmarks; print('✅ Scripts validated')"
    timeout-minutes: 10
env:
  PYTHONUNBUFFERED: '1'
  CI: 'true'
permissions:
  contents: read
  pull-requests: write
