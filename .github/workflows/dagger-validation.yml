name: ğŸ§ª Dagger Pipeline Validation

on:
  pull_request:
    paths:
      - 'dagger/**'
      - 'scripts/improved_*'
      - 'tests/test_improved_*'
  workflow_dispatch:

jobs:
  validate-pipelines:
    runs-on: ubuntu-latest
    name: ğŸ” Validate Dagger pipelines
    
    steps:
      - name: ğŸ”„ Checkout repository
        uses: actions/checkout@v4
        
      - name: ğŸ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
          
      - name: ğŸ“¦ Install Dagger
        run: pip install dagger-io
        
      - name: ğŸ§ª Run test pipeline
        run: |
          echo "ğŸ§ª Running Dagger test pipeline..."
          dagger call test-pipeline --source=.
        env:
          DAGGER_CLOUD_TOKEN: ${{ secrets.DAGGER_CLOUD_TOKEN }}
          
      - name: ğŸ” Run system validation
        run: |
          echo "ğŸ” Running complete system validation..."
          dagger call validate-system --source=.
        env:
          DAGGER_CLOUD_TOKEN: ${{ secrets.DAGGER_CLOUD_TOKEN }}